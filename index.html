<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title></title>
    <meta charset="utf-8">
    <meta name="description" content="">
    <meta name="author" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="">
    <!--[if lt IE 9]>
    <script src="//cdn.jsdelivr.net/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="shortcut icon" href="">

    <style>
        /* Original https://labs.loupbrun.ca/buttons/ */
        .tau .btn {
            display: inline-block;
            margin: 6px;
            font-size: inherit;
            line-height: 1.42;
            padding: 1.2em 2.4em;
            font-weight: normal;
            border-width: 0;
            border-style: solid;
            background: transparent;
            border-radius: 0;
            cursor: pointer;
            font-family: "Booster Next FY", "Avenir Next", Avenir, sans-serif;
            user-select: none;
            vertical-align: bottom;
            transition: background-color 0.3s; }
        .tau .btn.btn-disabled {
            cursor: not-allowed;
            opacity: 0.8; }
        .tau .btn.btn-disabled:active {
            opacity: 0.6; }
        .tau .btn:active {
            transition-duration: 0.1s; }

        .tau .btn-primary {
            background-color: #52C11F;
            color: #E6EAEF; }
        .tau .btn-primary:hover {
            background-color: #59d322; }
        .tau .btn-primary:active {
            background-color: #4baf1c; }    </style>
</head>
<body>
<div id="container" style="min-width: 310px; max-width: 800px; height: 400px; margin: 0 auto"></div>

<div class="tau">
    <button id="button" class="btn btn-primary">Rotate</button>
</div>

<script src="https://code.highcharts.com/highcharts.js"></script>
<script src="https://code.highcharts.com/modules/exporting.js"></script>
<script src="https://code.highcharts.com/modules/export-data.js"></script>

<script>
    var duration = 500;
    var inputIndex = 0;

    var formatter = function () {
        return Highcharts.numberFormat(this.y, 0, '', ',');
    };

    var deepCopy = function (obj) {
        return JSON.parse(JSON.stringify(obj));
    };

    var input = [{"options":{"title":{"text":"The number of tourists to Japan"},"subtitle":{"text":"1990"}},"values":[428171,23238,497591,113116,40405,28499,36786,18109,26654,0,6662],"categories":["Korea","China","Taiwan","HongKong","Thai","Singapore","Malaysia","Indonesia","Philippines","Vietnam","India"]},{"options":{"title":{"text":"The number of tourists to Japan"},"subtitle":{"text":"1991"}},"values":[504099,24864,565882,114421,69004,27138,50889,18338,23552,0,6241],"categories":["Korea","China","Taiwan","HongKong","Thai","Singapore","Malaysia","Indonesia","Philippines","Vietnam","India"]},{"options":{"title":{"text":"The number of tourists to Japan"},"subtitle":{"text":"1992"}},"values":[502871,29147,622707,136040,58583,25433,35670,17054,20734,0,5801],"categories":["Korea","China","Taiwan","HongKong","Thai","Singapore","Malaysia","Indonesia","Philippines","Vietnam","India"]},{"options":{"title":{"text":"The number of tourists to Japan"},"subtitle":{"text":"1993"}},"values":[473318,26454,581958,113366,35298,23289,23698,15430,19937,0,5705],"categories":["Korea","China","Taiwan","HongKong","Thai","Singapore","Malaysia","Indonesia","Philippines","Vietnam","India"]},{"options":{"title":{"text":"The number of tourists to Japan"},"subtitle":{"text":"1994"}},"values":[511753,24550,562053,109391,25542,24512,20472,13869,22048,0,5557],"categories":["Korea","China","Taiwan","HongKong","Thai","Singapore","Malaysia","Indonesia","Philippines","Vietnam","India"]},{"options":{"title":{"text":"The number of tourists to Japan"},"subtitle":{"text":"1995"}},"values":[459166,25489,490080,63301,18409,23552,22264,11267,22294,0,4891],"categories":["Korea","China","Taiwan","HongKong","Thai","Singapore","Malaysia","Indonesia","Philippines","Vietnam","India"]},{"options":{"title":{"text":"The number of tourists to Japan"},"subtitle":{"text":"1996"}},"values":[565034,29291,628192,133700,26460,24010,32389,14353,17391,0,5350],"categories":["Korea","China","Taiwan","HongKong","Thai","Singapore","Malaysia","Indonesia","Philippines","Vietnam","India"]},{"options":{"title":{"text":"The number of tourists to Japan"},"subtitle":{"text":"1997"}},"values":[587299,33431,725785,227909,26517,23971,39531,16437,17447,0,6491],"categories":["Korea","China","Taiwan","HongKong","Thai","Singapore","Malaysia","Indonesia","Philippines","Vietnam","India"]},{"options":{"title":{"text":"The number of tourists to Japan"},"subtitle":{"text":"1998"}},"values":[380279,35616,744089,318827,17814,16979,37879,7112,16072,0,6891],"categories":["Korea","China","Taiwan","HongKong","Thai","Singapore","Malaysia","Indonesia","Philippines","Vietnam","India"]},{"options":{"title":{"text":"The number of tourists to Japan"},"subtitle":{"text":"1999"}},"values":[516053,37153,829969,215463,24255,25161,43387,11097,15287,0,7403],"categories":["Korea","China","Taiwan","HongKong","Thai","Singapore","Malaysia","Indonesia","Philippines","Vietnam","India"]},{"options":{"title":{"text":"The number of tourists to Japan"},"subtitle":{"text":"2000"}},"values":[603697,45270,807261,205315,28452,30635,45675,13874,17322,0,8214],"categories":["Korea","China","Taiwan","HongKong","Thai","Singapore","Malaysia","Indonesia","Philippines","Vietnam","India"]},{"options":{"title":{"text":"The number of tourists to Japan"},"subtitle":{"text":"2001"}},"values":[653370,72118,708065,226862,29764,28877,44240,16432,17695,0,8037],"categories":["Korea","China","Taiwan","HongKong","Thai","Singapore","Malaysia","Indonesia","Philippines","Vietnam","India"]},{"options":{"title":{"text":"The number of tourists to Japan"},"subtitle":{"text":"2002"}},"values":[756991,101299,769074,255294,38193,34869,51383,19328,21645,0,9446],"categories":["Korea","China","Taiwan","HongKong","Thai","Singapore","Malaysia","Indonesia","Philippines","Vietnam","India"]},{"options":{"title":{"text":"The number of tourists to Japan"},"subtitle":{"text":"2003"}},"values":[917590,95991,681490,228073,43832,35229,52390,23845,26742,0,9132],"categories":["Korea","China","Taiwan","HongKong","Thai","Singapore","Malaysia","Indonesia","Philippines","Vietnam","India"]},{"options":{"title":{"text":"The number of tourists to Japan"},"subtitle":{"text":"2004"}},"values":[1037483,189692,962168,271492,63017,38263,62930,22809,38223,0,11382],"categories":["Korea","China","Taiwan","HongKong","Thai","Singapore","Malaysia","Indonesia","Philippines","Vietnam","India"]},{"options":{"title":{"text":"The number of tourists to Japan"},"subtitle":{"text":"2005"}},"values":[1215766,201940,1160402,269123,75333,63772,40637,23606,53583,0,13654],"categories":["Korea","China","Taiwan","HongKong","Thai","Singapore","Malaysia","Indonesia","Philippines","Vietnam","India"]},{"options":{"title":{"text":"The number of tourists to Japan"},"subtitle":{"text":"2006"}},"values":[1614811,323018,1184228,322428,80330,84648,49197,33662,52084,6498,19676],"categories":["Korea","China","Taiwan","HongKong","Thai","Singapore","Malaysia","Indonesia","Philippines","Vietnam","India"]},{"options":{"title":{"text":"The number of tourists to Japan"},"subtitle":{"text":"2007"}},"values":[2084195,407286,1255642,399681,119718,119239,62551,38430,45971,8427,21373],"categories":["Korea","China","Taiwan","HongKong","Thai","Singapore","Malaysia","Indonesia","Philippines","Vietnam","India"]},{"options":{"title":{"text":"The number of tourists to Japan"},"subtitle":{"text":"2008"}},"values":[1892654,455728,1264425,513185,143541,137222,70355,40494,42515,9461,22441],"categories":["Korea","China","Taiwan","HongKong","Thai","Singapore","Malaysia","Indonesia","Philippines","Vietnam","India"]},{"options":{"title":{"text":"The number of tourists to Japan"},"subtitle":{"text":"2009"}},"values":[1153935,481696,912982,418169,135903,121493,60356,41471,38107,10062,20310],"categories":["Korea","China","Taiwan","HongKong","Thai","Singapore","Malaysia","Indonesia","Philippines","Vietnam","India"]},{"options":{"title":{"text":"The number of tourists to Japan"},"subtitle":{"text":"2010"}},"values":[1963002,831652,1139339,473031,165901,151580,80308,53195,43298,13224,20929],"categories":["Korea","China","Taiwan","HongKong","Thai","Singapore","Malaysia","Indonesia","Philippines","Vietnam","India"]},{"options":{"title":{"text":"The number of tourists to Japan"},"subtitle":{"text":"2011"}},"values":[1199020,453182,868010,333773,95185,86034,50312,33954,29832,8741,12211],"categories":["Korea","China","Taiwan","HongKong","Thai","Singapore","Malaysia","Indonesia","Philippines","Vietnam","India"]},{"options":{"title":{"text":"The number of tourists to Japan"},"subtitle":{"text":"2012"}},"values":[1569278,829206,1329331,447486,201623,112842,95030,68211,48735,15523,19096],"categories":["Korea","China","Taiwan","HongKong","Thai","Singapore","Malaysia","Indonesia","Philippines","Vietnam","India"]},{"options":{"title":{"text":"The number of tourists to Japan"},"subtitle":{"text":"2013"}},"values":[1974117,704737,2067269,708997,392856,158753,140484,101726,68720,26402,23265],"categories":["Korea","China","Taiwan","HongKong","Thai","Singapore","Malaysia","Indonesia","Philippines","Vietnam","India"]},{"options":{"title":{"text":"The number of tourists to Japan"},"subtitle":{"text":"2014"}},"values":[2285069,1753572,2674425,886308,599690,194092,211898,120535,136561,41375,29035],"categories":["Korea","China","Taiwan","HongKong","Thai","Singapore","Malaysia","Indonesia","Philippines","Vietnam","India"]},{"options":{"title":{"text":"The number of tourists to Japan"},"subtitle":{"text":"2015"}},"values":[3519608,4237920,3505149,1480564,737943,272566,266805,164040,212795,62060,38633],"categories":["Korea","China","Taiwan","HongKong","Thai","Singapore","Malaysia","Indonesia","Philippines","Vietnam","India"]},{"options":{"title":{"text":"The number of tourists to Japan"},"subtitle":{"text":"2016"}},"values":[4593527,5534509,3981551,1793354,838025,324184,355528,218306,285179,77099,49714],"categories":["Korea","China","Taiwan","HongKong","Thai","Singapore","Malaysia","Indonesia","Philippines","Vietnam","India"]},{"options":{"title":{"text":"The number of tourists to Japan"},"subtitle":{"text":"2017"}},"values":[6593055,6447740,4363276,2180760,919000,364962,399108,291532,353081,107162,53232],"categories":["Korea","China","Taiwan","HongKong","Thai","Singapore","Malaysia","Indonesia","Philippines","Vietnam","India"]}];

    var baseSeries = [{
        name: 'Series 1',
        animation: {duration: duration},
        data: null,
        dataLabels: {
            enabled: true,
            defer: true
        }
    }];

    var baseOptions = {
        chart: {
            type: 'bar'
        },
        title: {
            text: null
        },
        subtitle: {
            text: null
        },
        xAxis: {
            categories: [],
            title: {
                text: null
            }
        },
        yAxis: {
            min: 0,
            title: {
                text: null
            }
        },
        tooltip: {
            enabled: false
        },
        exporting: false,
        credits: false,
        legend: false,
        series: null
    };

    var chart = null;

    (function () {
        var sortedInput = [];

        input.forEach(function (elem, i) {
            var ary = [];
            elem.values.forEach(function (value, j) {
                ary[j] = {value: value, category: elem.categories[j]}
            });

            ary.sort(function (a, b) {
                return b.value - a.value;
            });

            var sortedElem = {values: [], categories: []};
            ary.forEach(function (obj, i) {
                sortedElem.values[i] = obj.value;
                sortedElem.categories[i] = obj.category;
            });
            if (elem.options) {
                sortedElem.options = elem.options;
            }

            sortedInput[i] = sortedElem;
        });

        input = sortedInput;

        var series = deepCopy(baseSeries);
        series[0].data = input[inputIndex].values;
        series[0].dataLabels.formatter = formatter;

        var options = Object.assign({}, baseOptions);
        if (input[inputIndex].options) {
            options = Object.assign(options, input[inputIndex].options)
        }
        options.series = series;
        options.xAxis.categories = input[inputIndex].categories;

        chart = Highcharts.chart('container', options);
    })();

    var countUp = function (nextSeries, duration, animation, callback) {
        var maxLoopCount = 5;
        var interval = duration / maxLoopCount;
        var loopCount = 0;

        var values = [];
        chart.series[0].data.forEach(function (d, i) {
            values[i] = d.y;
        });

        var nextValues = [];
        chart.xAxis[0].categories.forEach(function (c, i) {
            input[inputIndex].categories.forEach(function (cc, j) {
                if (c === cc) {
                    nextValues[i] = nextSeries[0].data[j];
                }
            });
        });

        if (!animation) {
            chart.series[0].setData(nextValues, true, {duration: duration});
            // setTimeout(function () {
                callback();
            // }, duration);

            return;
        }

        var timer = setInterval(function () {
            var tmpValues = [];
            values.forEach(function (v, i) {
                if (loopCount >= maxLoopCount - 1) {
                    tmpValues[i] = nextValues[i];
                } else {
                    if (v === nextValues[i]) {
                        tmpValues[i] = v;
                    } else {
                        var diff = Math.abs(v - nextValues[i]) / maxLoopCount;
                        tmpValues[i] = v + parseFloat(loopCount) * diff;
                    }
                }
            });

            chart.series[0].setData(tmpValues, true, {duration: interval});
            loopCount++;

            if (loopCount >= maxLoopCount) {
                clearInterval(timer);
                if (callback) {
                    // setTimeout(function () {
                        callback();
                    // }, interval);
                }
            }
        }, interval);
    };

    var rotateBars = function (callback) {
        var points = chart.series[0].points;
        var ticks = chart.xAxis[0].ticks;

        var sortedPoints = points.slice();
        sortedPoints.sort(function (a, b) {
            return b.y - a.y;
        });

        points.forEach(function (point, i) {
            sortedPoints.forEach(function (sPoint, j) {
                if (point === sPoint) {
                    points[i].graphic.animate({
                        x: points[j].shapeArgs.x
                    }, {duration: duration});

                    points[i].dataLabel.animate({
                        y: points[j].dataLabel.y
                    }, {duration: duration});

                    ticks[i].label.animate({
                        y: ticks[j].label.xy.y
                    }, {duration: duration});
                }
            });
        });

        if (callback) {
            setTimeout(function () {
                callback();
            }, duration);
        }
    };

    var reDraw = function (series, categories, options, callback) {
        options.xAxis.categories = categories;
        options.series = series;

        chart.destroy();
        chart = Highcharts.chart('container', options);

        if (callback) {
            callback();
        }
    };

    document.getElementById("button").addEventListener("click", function (event) {
        if (input.length - 1 <= inputIndex) {
            return;
        }
        event.target.classList.add("btn-disabled");
        inputIndex++;

        var nextSeries = deepCopy(baseSeries);
        nextSeries[0].animation = false;
        nextSeries[0].data = input[inputIndex].values;
        nextSeries[0].dataLabels.formatter = formatter;

        var options = Object.assign({}, baseOptions);
        if (input[inputIndex].options) {
            options = Object.assign(options, input[inputIndex].options)
        }

        countUp(nextSeries, duration, false, function () {
            rotateBars(function () {
                reDraw(nextSeries, input[inputIndex].categories, options, function () {
                    event.target.classList.remove("btn-disabled");
                });
            });
        });

    }, false);
</script>
</body>
</html>
