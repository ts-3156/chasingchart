<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title></title>
    <meta charset="utf-8">
    <meta name="description" content="">
    <meta name="author" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="">
    <!--[if lt IE 9]>
    <script src="//cdn.jsdelivr.net/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="shortcut icon" href="">

    <style>
        /* Original https://labs.loupbrun.ca/buttons/ */
        .tau .btn {
            display: inline-block;
            margin: 6px;
            font-size: inherit;
            line-height: 1.42;
            padding: 1.2em 2.4em;
            font-weight: normal;
            border-width: 0;
            border-style: solid;
            background: transparent;
            border-radius: 0;
            cursor: pointer;
            font-family: "Booster Next FY", "Avenir Next", Avenir, sans-serif;
            user-select: none;
            vertical-align: bottom;
            transition: background-color 0.3s; }
        .tau .btn.btn-disabled {
            cursor: not-allowed;
            opacity: 0.8; }
        .tau .btn.btn-disabled:active {
            opacity: 0.6; }
        .tau .btn:active {
            transition-duration: 0.1s; }

        .tau .btn-primary {
            background-color: #52C11F;
            color: #E6EAEF; }
        .tau .btn-primary:hover {
            background-color: #59d322; }
        .tau .btn-primary:active {
            background-color: #4baf1c; }    </style>
</head>
<body>
<div id="container" style="min-width: 310px; max-width: 800px; height: 400px; margin: 0 auto"></div>

<div class="tau" style="min-width: 310px; max-width: 800px; height: 400px; margin: 0 auto">
    <button id="button" class="btn btn-primary" style="display: block; margin: 0 auto">Start</button>
</div>

<script src="https://code.highcharts.com/highcharts.js"></script>
<script src="https://code.highcharts.com/modules/exporting.js"></script>
<script src="https://code.highcharts.com/modules/export-data.js"></script>
<script src="https://cdn.jsdelivr.net/npm/lodash@4.17.11/lodash.min.js"></script>

<script>
    var duration = 500;
    var inputIndex = 0;

    var formatter = function () {
        // return Highcharts.numberFormat(this.y, 0, '', ',');
        var v = this.y;
        if (v > 1000000000) {
            v = Math.floor(v / 1000000000) + "G"
        } else if (v > 1000000) {
            v = Math.floor(v / 1000000) + "M"
        } else if (v > 1000) {
            v = Math.floor(v / 1000) + "K"
        }
        return v;
    };

    var deepCopy = function (obj) {
        return JSON.parse(JSON.stringify(obj));
    };

    // TODO Avoid using lodash
    var merge = function (src1, src2) {
        // return Object.assign(deepCopy(src1), deepCopy(src2));
        return _.merge(deepCopy(src1), deepCopy(src2));
    };

    // var input = [{"options":{"title":{"text":"The number of tourists to Japan"},"subtitle":{"text":"1990"}},"values":[428171,23238,497591,113116,40405,28499,36786,18109,26654,0,6662],"categories":["Korea","China","Taiwan","HongKong","Thai","Singapore","Malaysia","Indonesia","Philippines","Vietnam","India"]},{"options":{"title":{"text":"The number of tourists to Japan"},"subtitle":{"text":"1991"}},"values":[504099,24864,565882,114421,69004,27138,50889,18338,23552,0,6241],"categories":["Korea","China","Taiwan","HongKong","Thai","Singapore","Malaysia","Indonesia","Philippines","Vietnam","India"]},{"options":{"title":{"text":"The number of tourists to Japan"},"subtitle":{"text":"1992"}},"values":[502871,29147,622707,136040,58583,25433,35670,17054,20734,0,5801],"categories":["Korea","China","Taiwan","HongKong","Thai","Singapore","Malaysia","Indonesia","Philippines","Vietnam","India"]},{"options":{"title":{"text":"The number of tourists to Japan"},"subtitle":{"text":"1993"}},"values":[473318,26454,581958,113366,35298,23289,23698,15430,19937,0,5705],"categories":["Korea","China","Taiwan","HongKong","Thai","Singapore","Malaysia","Indonesia","Philippines","Vietnam","India"]},{"options":{"title":{"text":"The number of tourists to Japan"},"subtitle":{"text":"1994"}},"values":[511753,24550,562053,109391,25542,24512,20472,13869,22048,0,5557],"categories":["Korea","China","Taiwan","HongKong","Thai","Singapore","Malaysia","Indonesia","Philippines","Vietnam","India"]},{"options":{"title":{"text":"The number of tourists to Japan"},"subtitle":{"text":"1995"}},"values":[459166,25489,490080,63301,18409,23552,22264,11267,22294,0,4891],"categories":["Korea","China","Taiwan","HongKong","Thai","Singapore","Malaysia","Indonesia","Philippines","Vietnam","India"]},{"options":{"title":{"text":"The number of tourists to Japan"},"subtitle":{"text":"1996"}},"values":[565034,29291,628192,133700,26460,24010,32389,14353,17391,0,5350],"categories":["Korea","China","Taiwan","HongKong","Thai","Singapore","Malaysia","Indonesia","Philippines","Vietnam","India"]},{"options":{"title":{"text":"The number of tourists to Japan"},"subtitle":{"text":"1997"}},"values":[587299,33431,725785,227909,26517,23971,39531,16437,17447,0,6491],"categories":["Korea","China","Taiwan","HongKong","Thai","Singapore","Malaysia","Indonesia","Philippines","Vietnam","India"]},{"options":{"title":{"text":"The number of tourists to Japan"},"subtitle":{"text":"1998"}},"values":[380279,35616,744089,318827,17814,16979,37879,7112,16072,0,6891],"categories":["Korea","China","Taiwan","HongKong","Thai","Singapore","Malaysia","Indonesia","Philippines","Vietnam","India"]},{"options":{"title":{"text":"The number of tourists to Japan"},"subtitle":{"text":"1999"}},"values":[516053,37153,829969,215463,24255,25161,43387,11097,15287,0,7403],"categories":["Korea","China","Taiwan","HongKong","Thai","Singapore","Malaysia","Indonesia","Philippines","Vietnam","India"]},{"options":{"title":{"text":"The number of tourists to Japan"},"subtitle":{"text":"2000"}},"values":[603697,45270,807261,205315,28452,30635,45675,13874,17322,0,8214],"categories":["Korea","China","Taiwan","HongKong","Thai","Singapore","Malaysia","Indonesia","Philippines","Vietnam","India"]},{"options":{"title":{"text":"The number of tourists to Japan"},"subtitle":{"text":"2001"}},"values":[653370,72118,708065,226862,29764,28877,44240,16432,17695,0,8037],"categories":["Korea","China","Taiwan","HongKong","Thai","Singapore","Malaysia","Indonesia","Philippines","Vietnam","India"]},{"options":{"title":{"text":"The number of tourists to Japan"},"subtitle":{"text":"2002"}},"values":[756991,101299,769074,255294,38193,34869,51383,19328,21645,0,9446],"categories":["Korea","China","Taiwan","HongKong","Thai","Singapore","Malaysia","Indonesia","Philippines","Vietnam","India"]},{"options":{"title":{"text":"The number of tourists to Japan"},"subtitle":{"text":"2003"}},"values":[917590,95991,681490,228073,43832,35229,52390,23845,26742,0,9132],"categories":["Korea","China","Taiwan","HongKong","Thai","Singapore","Malaysia","Indonesia","Philippines","Vietnam","India"]},{"options":{"title":{"text":"The number of tourists to Japan"},"subtitle":{"text":"2004"}},"values":[1037483,189692,962168,271492,63017,38263,62930,22809,38223,0,11382],"categories":["Korea","China","Taiwan","HongKong","Thai","Singapore","Malaysia","Indonesia","Philippines","Vietnam","India"]},{"options":{"title":{"text":"The number of tourists to Japan"},"subtitle":{"text":"2005"}},"values":[1215766,201940,1160402,269123,75333,63772,40637,23606,53583,0,13654],"categories":["Korea","China","Taiwan","HongKong","Thai","Singapore","Malaysia","Indonesia","Philippines","Vietnam","India"]},{"options":{"title":{"text":"The number of tourists to Japan"},"subtitle":{"text":"2006"}},"values":[1614811,323018,1184228,322428,80330,84648,49197,33662,52084,6498,19676],"categories":["Korea","China","Taiwan","HongKong","Thai","Singapore","Malaysia","Indonesia","Philippines","Vietnam","India"]},{"options":{"title":{"text":"The number of tourists to Japan"},"subtitle":{"text":"2007"}},"values":[2084195,407286,1255642,399681,119718,119239,62551,38430,45971,8427,21373],"categories":["Korea","China","Taiwan","HongKong","Thai","Singapore","Malaysia","Indonesia","Philippines","Vietnam","India"]},{"options":{"title":{"text":"The number of tourists to Japan"},"subtitle":{"text":"2008"}},"values":[1892654,455728,1264425,513185,143541,137222,70355,40494,42515,9461,22441],"categories":["Korea","China","Taiwan","HongKong","Thai","Singapore","Malaysia","Indonesia","Philippines","Vietnam","India"]},{"options":{"title":{"text":"The number of tourists to Japan"},"subtitle":{"text":"2009"}},"values":[1153935,481696,912982,418169,135903,121493,60356,41471,38107,10062,20310],"categories":["Korea","China","Taiwan","HongKong","Thai","Singapore","Malaysia","Indonesia","Philippines","Vietnam","India"]},{"options":{"title":{"text":"The number of tourists to Japan"},"subtitle":{"text":"2010"}},"values":[1963002,831652,1139339,473031,165901,151580,80308,53195,43298,13224,20929],"categories":["Korea","China","Taiwan","HongKong","Thai","Singapore","Malaysia","Indonesia","Philippines","Vietnam","India"]},{"options":{"title":{"text":"The number of tourists to Japan"},"subtitle":{"text":"2011"}},"values":[1199020,453182,868010,333773,95185,86034,50312,33954,29832,8741,12211],"categories":["Korea","China","Taiwan","HongKong","Thai","Singapore","Malaysia","Indonesia","Philippines","Vietnam","India"]},{"options":{"title":{"text":"The number of tourists to Japan"},"subtitle":{"text":"2012"}},"values":[1569278,829206,1329331,447486,201623,112842,95030,68211,48735,15523,19096],"categories":["Korea","China","Taiwan","HongKong","Thai","Singapore","Malaysia","Indonesia","Philippines","Vietnam","India"]},{"options":{"title":{"text":"The number of tourists to Japan"},"subtitle":{"text":"2013"}},"values":[1974117,704737,2067269,708997,392856,158753,140484,101726,68720,26402,23265],"categories":["Korea","China","Taiwan","HongKong","Thai","Singapore","Malaysia","Indonesia","Philippines","Vietnam","India"]},{"options":{"title":{"text":"The number of tourists to Japan"},"subtitle":{"text":"2014"}},"values":[2285069,1753572,2674425,886308,599690,194092,211898,120535,136561,41375,29035],"categories":["Korea","China","Taiwan","HongKong","Thai","Singapore","Malaysia","Indonesia","Philippines","Vietnam","India"]},{"options":{"title":{"text":"The number of tourists to Japan"},"subtitle":{"text":"2015"}},"values":[3519608,4237920,3505149,1480564,737943,272566,266805,164040,212795,62060,38633],"categories":["Korea","China","Taiwan","HongKong","Thai","Singapore","Malaysia","Indonesia","Philippines","Vietnam","India"]},{"options":{"title":{"text":"The number of tourists to Japan"},"subtitle":{"text":"2016"}},"values":[4593527,5534509,3981551,1793354,838025,324184,355528,218306,285179,77099,49714],"categories":["Korea","China","Taiwan","HongKong","Thai","Singapore","Malaysia","Indonesia","Philippines","Vietnam","India"]},{"options":{"title":{"text":"The number of tourists to Japan"},"subtitle":{"text":"2017"}},"values":[6593055,6447740,4363276,2180760,919000,364962,399108,291532,353081,107162,53232],"categories":["Korea","China","Taiwan","HongKong","Thai","Singapore","Malaysia","Indonesia","Philippines","Vietnam","India"]}];
    var input = [{"options":{"title":{"text":"Gross Domestic Product (GDP)"},"subtitle":{"text":"1970"}},"values":[1075900000000,89649505386,211514189115,215018556281,130682295637,148943302452,59602914740,113026327278,35213857570],"categories":["United States","China","Japan","Germany","United Kingdom","France","India","Italy","Brazil"]},{"options":{"title":{"text":"Gross Domestic Product (GDP)"},"subtitle":{"text":"1971"}},"values":[1167800000000,97184613337,238914960843,249038963803,148106601857,166572277582,63944116162,124265455804,39331867588],"categories":["United States","China","Japan","Germany","United Kingdom","France","India","Italy","Brazil"]},{"options":{"title":{"text":"Gross Domestic Product (GDP)"},"subtitle":{"text":"1972"}},"values":[1282400000000,109297408417,316393344651,298662347155,169969084028,204274079346,69555666090,144777666554,50623841100],"categories":["United States","China","Japan","Germany","United Kingdom","France","India","Italy","Brazil"]},{"options":{"title":{"text":"Gross Domestic Product (GDP)"},"subtitle":{"text":"1973"}},"values":[1428500000000,134190135935,429857372904,396872934174,192551676951,265373647512,82947352672,174917701805,71672675416],"categories":["United States","China","Japan","Germany","United Kingdom","France","India","Italy","Brazil"]},{"options":{"title":{"text":"Gross Domestic Product (GDP)"},"subtitle":{"text":"1974"}},"values":[1548800000000,139644095523,477155786489,443620129946,206152361031,286517111990,93619184953,198921429672,91887958745],"categories":["United States","China","Japan","Germany","United Kingdom","France","India","Italy","Brazil"]},{"options":{"title":{"text":"Gross Domestic Product (GDP)"},"subtitle":{"text":"1975"}},"values":[1688900000000,158640714141,518855814544,488769604286,241734621312,362016887444,97386172067,226966009113,108051408879],"categories":["United States","China","Japan","Germany","United Kingdom","France","India","Italy","Brazil"]},{"options":{"title":{"text":"Gross Domestic Product (GDP)"},"subtitle":{"text":"1976"}},"values":[1877600000000,152894818251,583142956490,517774666397,232610445457,373413756627,98121939189,223994187491,127741369548],"categories":["United States","China","Japan","Germany","United Kingdom","France","India","Italy","Brazil"]},{"options":{"title":{"text":"Gross Domestic Product (GDP)"},"subtitle":{"text":"1977"}},"values":[2086000000000,170414438472,717696307918,598219411271,263079306617,411470980652,113854628983,256737854007,148671741472],"categories":["United States","China","Japan","Germany","United Kingdom","France","India","Italy","Brazil"]},{"options":{"title":{"text":"Gross Domestic Product (GDP)"},"subtitle":{"text":"1978"}},"values":[2356600000000,215852934317,1008391938420,737672914164,335880078400,508169645279,131706947961,314020487156,168803353854],"categories":["United States","China","Japan","Germany","United Kingdom","France","India","Italy","Brazil"]},{"options":{"title":{"text":"Gross Domestic Product (GDP)"},"subtitle":{"text":"1979"}},"values":[2632100000000,262263665764,1049578503048,877974590623,439011580878,615851702775,145750633454,392374707889,186095322489],"categories":["United States","China","Japan","Germany","United Kingdom","France","India","Italy","Brazil"]},{"options":{"title":{"text":"Gross Domestic Product (GDP)"},"subtitle":{"text":"1980"}},"values":[2862500000000,305345702286,1099692755749,946737926470,564954276868,703541414121,179148154405,475662912012,191124804736],"categories":["United States","China","Japan","Germany","United Kingdom","France","India","Italy","Brazil"]},{"options":{"title":{"text":"Gross Domestic Product (GDP)"},"subtitle":{"text":"1981"}},"values":[3210900000000,290830334936,1215508536164,797429844205,540720761152,617588942470,191091507277,429289362493,225557700609],"categories":["United States","China","Japan","Germany","United Kingdom","France","India","Italy","Brazil"]},{"options":{"title":{"text":"Gross Domestic Product (GDP)"},"subtitle":{"text":"1982"}},"values":[3345000000000,286720239663,1129894674850,773640309827,515006780277,586830700586,195115374008,425855252726,238783475400],"categories":["United States","China","Japan","Germany","United Kingdom","France","India","Italy","Brazil"]},{"options":{"title":{"text":"Gross Domestic Product (GDP)"},"subtitle":{"text":"1983"}},"values":[3638100000000,307677123138,1232343977239,767791752313,489599764280,561871824412,212886185550,441569872754,170392084891],"categories":["United States","China","Japan","Germany","United Kingdom","France","India","Italy","Brazil"]},{"options":{"title":{"text":"Gross Domestic Product (GDP)"},"subtitle":{"text":"1984"}},"values":[4040700000000,316627934182,1309740021613,722364198686,461483005638,532661673273,210861077625,436445905262,175506749236],"categories":["United States","China","Japan","Germany","United Kingdom","France","India","Italy","Brazil"]},{"options":{"title":{"text":"Gross Domestic Product (GDP)"},"subtitle":{"text":"1985"}},"values":[4346700000000,312617232180,1400714611078,729750553967,489256281229,555201444540,219581239801,450706148318,187426231446],"categories":["United States","China","Japan","Germany","United Kingdom","France","India","Italy","Brazil"]},{"options":{"title":{"text":"Gross Domestic Product (GDP)"},"subtitle":{"text":"1986"}},"values":[4590100000000,303340050932,2075033831752,1042336633046,601455004222,774573752601,240583242437,638241564416,225331911214],"categories":["United States","China","Japan","Germany","United Kingdom","France","India","Italy","Brazil"]},{"options":{"title":{"text":"Gross Domestic Product (GDP)"},"subtitle":{"text":"1987"}},"values":[4870200000000,330302786062,2514283894262,1293275940035,745130338366,938340861448,266236853440,803098257345,247124995809],"categories":["United States","China","Japan","Germany","United Kingdom","France","India","Italy","Brazil"]},{"options":{"title":{"text":"Gross Domestic Product (GDP)"},"subtitle":{"text":"1988"}},"values":[5252600000000,411923376588,3050638578314,1395863793292,910171030658,1023469741496,294526889596,888622302559,276045813776],"categories":["United States","China","Japan","Germany","United Kingdom","France","India","Italy","Brazil"]},{"options":{"title":{"text":"Gross Domestic Product (GDP)"},"subtitle":{"text":"1989"}},"values":[5657700000000,461065086662,3052315293223,1393746766278,926926143222,1030073588949,291584954675,925562711951,375485011471],"categories":["United States","China","Japan","Germany","United Kingdom","France","India","Italy","Brazil"]},{"options":{"title":{"text":"Gross Domestic Product (GDP)"},"subtitle":{"text":"1990"}},"values":[5979600000000,398623657413,3139974443543,1764943730856,1093213710428,1275259021898,316868661673,1177387425049,406897012370],"categories":["United States","China","Japan","Germany","United Kingdom","France","India","Italy","Brazil"]},{"options":{"title":{"text":"Gross Domestic Product (GDP)"},"subtitle":{"text":"1991"}},"values":[6174000000000,415603460826,3578140322587,1861851555801,1142766274398,1275510771559,280881975241,1242064198761,378581334818],"categories":["United States","China","Japan","Germany","United Kingdom","France","India","Italy","Brazil"]},{"options":{"title":{"text":"Gross Domestic Product (GDP)"},"subtitle":{"text":"1992"}},"values":[6539300000000,495670425885,3897825203795,2123239980533,1179713014952,1408660563436,282077544235,1315839039197,362646104793],"categories":["United States","China","Japan","Germany","United Kingdom","France","India","Italy","Brazil"]},{"options":{"title":{"text":"Gross Domestic Product (GDP)"},"subtitle":{"text":"1993"}},"values":[6878700000000,623053793921,4466565896444,2068483307989,1061457883634,1330166440078,275358986061,1061405269698,406935598866],"categories":["United States","China","Japan","Germany","United Kingdom","France","India","Italy","Brazil"]},{"options":{"title":{"text":"Gross Domestic Product (GDP)"},"subtitle":{"text":"1994"}},"values":[7308700000000,566471257911,4907039104409,2205908897277,1140443311075,1401629525682,315459553755,1095645647492,580494364386],"categories":["United States","China","Japan","Germany","United Kingdom","France","India","Italy","Brazil"]},{"options":{"title":{"text":"Gross Domestic Product (GDP)"},"subtitle":{"text":"1995"}},"values":[7664060000000,736870191684,5449117511910,2591446687867,1335285732853,1609793640304,358024059997,1170823864039,778052821653],"categories":["United States","China","Japan","Germany","United Kingdom","France","India","Italy","Brazil"]},{"options":{"title":{"text":"Gross Domestic Product (GDP)"},"subtitle":{"text":"1996"}},"values":[8100201000000,867223747395,4833714467770,2503734134369,1408873343865,1614335710868,377347312097,1308985801367,849622314042],"categories":["United States","China","Japan","Germany","United Kingdom","France","India","Italy","Brazil"]},{"options":{"title":{"text":"Gross Domestic Product (GDP)"},"subtitle":{"text":"1997"}},"values":[8608515000000,965338598160,4414734211850,2218667681135,1552391841294,1460712581567,409736207997,1239084536105,881512355620],"categories":["United States","China","Japan","Germany","United Kingdom","France","India","Italy","Brazil"]},{"options":{"title":{"text":"Gross Domestic Product (GDP)"},"subtitle":{"text":"1998"}},"values":[9089168000000,1032573139737,4032509740336,2243216151107,1638447072220,1510799663891,412355388105,1266342719919,853815355293],"categories":["United States","China","Japan","Germany","United Kingdom","France","India","Italy","Brazil"]},{"options":{"title":{"text":"Gross Domestic Product (GDP)"},"subtitle":{"text":"1999"}},"values":[9660624000000,1097137680065,4562078622081,2199893454158,1665739985454,1500232345954,439605378748,1248526866591,594071386008],"categories":["United States","China","Japan","Germany","United Kingdom","France","India","Italy","Brazil"]},{"options":{"title":{"text":"Gross Domestic Product (GDP)"},"subtitle":{"text":"2000"}},"values":[10284779000000,1214915134125,4887519736334,1949952436926,1647874399364,1368437313097,453578227175,1141759145356,652360092545],"categories":["United States","China","Japan","Germany","United Kingdom","France","India","Italy","Brazil"]},{"options":{"title":{"text":"Gross Domestic Product (GDP)"},"subtitle":{"text":"2001"}},"values":[10621824000000,1344077341394,4303542577788,1950631314261,1621615046318,1382205975785,468297082733,1162307439465,560746773511],"categories":["United States","China","Japan","Germany","United Kingdom","France","India","Italy","Brazil"]},{"options":{"title":{"text":"Gross Domestic Product (GDP)"},"subtitle":{"text":"2002"}},"values":[10977514000000,1477501847750,4115115650038,2079230657019,1768346430730,1500406097900,489607970101,1266568279699,512030132311],"categories":["United States","China","Japan","Germany","United Kingdom","France","India","Italy","Brazil"]},{"options":{"title":{"text":"Gross Domestic Product (GDP)"},"subtitle":{"text":"2003"}},"values":[11510670000000,1671065449752,4445659445310,2505637009859,2038486625930,1848052887351,573369816663,1569589103933,558922146818],"categories":["United States","China","Japan","Germany","United Kingdom","France","India","Italy","Brazil"]},{"options":{"title":{"text":"Gross Domestic Product (GDP)"},"subtitle":{"text":"2004"}},"values":[12274928000000,1966244002690,4815168028753,2819367615926,2398643304405,2124204553215,693726290422,1798392907639,669289321941],"categories":["United States","China","Japan","Germany","United Kingdom","France","India","Italy","Brazil"]},{"options":{"title":{"text":"Gross Domestic Product (GDP)"},"subtitle":{"text":"2005"}},"values":[13093726000000,2308800205020,4755410127549,2861339103616,2520709456695,2203623837238,812058878296,1852615856821,891633826592],"categories":["United States","China","Japan","Germany","United Kingdom","France","India","Italy","Brazil"]},{"options":{"title":{"text":"Gross Domestic Product (GDP)"},"subtitle":{"text":"2006"}},"values":[13855888000000,2774292479008,4530376770502,3002292568544,2692678753235,2324892820068,919117917120,1942534330847,1107626711424],"categories":["United States","China","Japan","Germany","United Kingdom","France","India","Italy","Brazil"]},{"options":{"title":{"text":"Gross Domestic Product (GDP)"},"subtitle":{"text":"2007"}},"values":[14477635000000,3571451058540,4515263396033,3439776907153,3074534037210,2662975825905,1169473124317,2202940255296,1397114247307],"categories":["United States","China","Japan","Germany","United Kingdom","France","India","Italy","Brazil"]},{"options":{"title":{"text":"Gross Domestic Product (GDP)"},"subtitle":{"text":"2008"}},"values":[14718582000000,4604285289743,5037908759112,3752504608450,2890743681249,2923573946917,1254802704031,2390817771764,1695855391842],"categories":["United States","China","Japan","Germany","United Kingdom","France","India","Italy","Brazil"]},{"options":{"title":{"text":"Gross Domestic Product (GDP)"},"subtitle":{"text":"2009"}},"values":[14418739000000,5121680444416,5231383284723,3417799117759,2382754478608,2693665189295,1297597246412,2185028535613,1666996294336],"categories":["United States","China","Japan","Germany","United Kingdom","France","India","Italy","Brazil"]},{"options":{"title":{"text":"Gross Domestic Product (GDP)"},"subtitle":{"text":"2010"}},"values":[14964372000000,6066351252194,5700098114744,3417094562649,2441173394730,2646837111795,1650634716716,2125058270214,2208838108593],"categories":["United States","China","Japan","Germany","United Kingdom","France","India","Italy","Brazil"]},{"options":{"title":{"text":"Gross Domestic Product (GDP)"},"subtitle":{"text":"2011"}},"values":[15517926000000,7522103366972,6157459594824,3757698281118,2619700404733,2862680142625,1871918072386,2276292459247,2616156606735],"categories":["United States","China","Japan","Germany","United Kingdom","France","India","Italy","Brazil"]},{"options":{"title":{"text":"Gross Domestic Product (GDP)"},"subtitle":{"text":"2012"}},"values":[16155254800000,8570348155604,6203213121334,3543983909148,2662085168499,2681416108537,1860877216073,2072823111906,2465228293863],"categories":["United States","China","Japan","Germany","United Kingdom","France","India","Italy","Brazil"]},{"options":{"title":{"text":"Gross Domestic Product (GDP)"},"subtitle":{"text":"2013"}},"values":[16691517000000,9635025555467,5155717056271,3752513503278,2739818680930,2808511203185,1917053761981,2130491269643,2472819362259],"categories":["United States","China","Japan","Germany","United Kingdom","France","India","Italy","Brazil"]},{"options":{"title":{"text":"Gross Domestic Product (GDP)"},"subtitle":{"text":"2014"}},"values":[17427609000000,10534526618925,4848733415524,3890606893347,3022827781881,2849305322685,2039198264964,2151732834352,2456043766063],"categories":["United States","China","Japan","Germany","United Kingdom","France","India","Italy","Brazil"]},{"options":{"title":{"text":"Gross Domestic Product (GDP)"},"subtitle":{"text":"2015"}},"values":[18120714000000,11226185011509,4379869200517,3375611100742,2885570309161,2433562015516,2132754527469,1832347450962,1803649810671],"categories":["United States","China","Japan","Germany","United Kingdom","France","India","Italy","Brazil"]},{"options":{"title":{"text":"Gross Domestic Product (GDP)"},"subtitle":{"text":"2016"}},"values":[18624475000000,11218281029298,4936211827875,3477796274497,2647898654635,2465453975282,2259642382872,1858913163928,1795925681016],"categories":["United States","China","Japan","Germany","United Kingdom","France","India","Italy","Brazil"]}];

    var baseSeries = [{
        name: 'Series 1',
        animation: {duration: duration},
        data: null,
        dataLabels: {
            align: 'right',
            enabled: true,
            defer: true
        }
    }];

    var baseOptions = {
        chart: {
            type: 'bar'
        },
        title: {
            text: null
        },
        subtitle: {
            text: null
        },
        xAxis: {
            categories: [],
            title: {
                text: null
            }
        },
        yAxis: {
            min: 0,
            endOnTick: false,
            // maxPadding: 0.0,
            title: {
                text: null
            }
        },
        tooltip: {
            enabled: false
        },
        exporting: false,
        credits: false,
        legend: false,
        series: null
    };

    var chart = null;

    (function () {
        var sortedInput = [];

        input.forEach(function (elem, i) {
            var ary = [];
            elem.values.forEach(function (value, j) {
                ary[j] = {value: value, category: elem.categories[j]}
            });

            ary.sort(function (a, b) {
                return b.value - a.value;
            });

            var sortedElem = {values: [], categories: []};
            ary.forEach(function (obj, i) {
                sortedElem.values[i] = obj.value;
                sortedElem.categories[i] = obj.category;
            });
            if (elem.options) {
                sortedElem.options = deepCopy(elem.options);
            } else {
                sortedElem.options = {};
            }

            sortedInput[i] = sortedElem;
        });

        input = sortedInput;

        var series = deepCopy(baseSeries);
        series[0].data = input[inputIndex].values;
        series[0].dataLabels.formatter = formatter;

        var options = deepCopy(baseOptions);
        if (input[inputIndex].options) {
            options = merge(options, input[inputIndex].options);
        }
        options.series = series;
        options.xAxis.categories = input[inputIndex].categories;

        chart = Highcharts.chart('container', options);
    })();

    var countUp = function (nextSeries, duration, animation, callback) {
        var maxLoopCount = 24;
        var interval = duration / maxLoopCount;
        var loopCount = 0;

        var values = [];
        chart.series[0].data.forEach(function (d, i) {
            values[i] = d.y;
        });

        var nextValues = [];
        chart.xAxis[0].categories.forEach(function (c, i) {
            input[inputIndex].categories.forEach(function (cc, j) {
                if (c === cc) {
                    nextValues[i] = nextSeries[0].data[j];
                }
            });
        });

        if (!animation) {
            chart.series[0].setData(nextValues, true, {duration: duration});
            // setTimeout(function () {
                callback();
            // }, duration);

            return;
        }

        var timer = setInterval(function () {
            var tmpValues = [];
            values.forEach(function (v, i) {
                if (loopCount >= maxLoopCount - 1) {
                    tmpValues[i] = nextValues[i];
                } else {
                    if (v === nextValues[i]) {
                        tmpValues[i] = v;
                    } else {
                        var diff = parseFloat(loopCount + 1) * Math.abs(v - nextValues[i]) / maxLoopCount;
                        if (v < nextValues[i]) {
                            tmpValues[i] = v + diff;
                        } else {
                            tmpValues[i] = v - diff;
                        }
                    }
                }
            });

            chart.series[0].setData(tmpValues, true, {duration: interval});
            loopCount++;

            if (loopCount >= maxLoopCount) {
                clearInterval(timer);
                if (callback) {
                    // setTimeout(function () {
                        callback();
                    // }, interval);
                }
            }
        }, interval);
    };

    var rotateBars = function (duration, callback) {
        var points = chart.series[0].points;
        var ticks = chart.xAxis[0].ticks;

        var sortedPoints = points.slice();
        sortedPoints.sort(function (a, b) {
            return b.y - a.y;
        });

        points.forEach(function (point, i) {
            sortedPoints.forEach(function (sPoint, j) {
                if (point === sPoint) {
                    points[i].graphic.animate({
                        x: points[j].shapeArgs.x
                    }, {duration: duration});

                    points[i].dataLabel.animate({
                        y: points[j].dataLabel.y
                    }, {duration: duration});

                    ticks[i].label.animate({
                        y: ticks[j].label.xy.y
                    }, {duration: duration});
                }
            });
        });

        if (callback) {
            setTimeout(function () {
                callback();
            }, duration);
        }
    };

    var reDraw = function (series, categories, options, callback) {
        options.xAxis.categories = categories;
        options.series = series;

        chart.destroy();
        chart = Highcharts.chart('container', options);

        if (callback) {
            callback();
        }
    };

    var clicked = function (event) {
        if (input.length - 1 <= inputIndex) {
            return;
        }
        event.target.classList.add("btn-disabled");
        inputIndex++;

        var nextSeries = deepCopy(baseSeries);
        nextSeries[0].animation = false;
        nextSeries[0].data = input[inputIndex].values;
        nextSeries[0].dataLabels.formatter = formatter;

        var options = deepCopy(baseOptions);
        if (input[inputIndex].options) {
            options = merge(options, input[inputIndex].options);
        }

        countUp(nextSeries, duration, true, function () {
            rotateBars(duration - 100, function () {
                reDraw(nextSeries, input[inputIndex].categories, options, function () {
                    event.target.classList.remove("btn-disabled");
                    clicked(event);
                });
            });
        });
    };

    document.getElementById("button").addEventListener("click", function (event) {
        clicked(event);
    }, false);
</script>
</body>
</html>
